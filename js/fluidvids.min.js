/*
	FluidVids.js - Fluid and Responsive YouTube/Vimeo Videos v1.0.0
	by Todd Motto: http://www.toddmotto.com
	Latest version: https://github.com/toddmotto/fluidvids

	Copyright 2013 Todd Motto
	Licensed under the MIT license
	http://www.opensource.org/licenses/mit-license.php

	A raw JavaScript alternative to FitVids.js, fluid width video embeds
*/
(function ( window, document, undefined ) {

	/*
	 * Grab all iframes on the page or return
	 */
	var iframes = document.getElementsByTagName( 'iframe' );

	/*
	 * Loop through the iframes array
	 */
	for ( var i = 0; i < iframes.length; i++ ) {

		var iframe = iframes[i],

		/*
	     * RegExp, extend this if you need more players
	     */
		players = /www.youtube.com|player.vimeo.com|www.youtube-nocookie.com/;

		/*
		 * If the RegExp pattern exists within the current iframe
		 */
		if ( iframe.src.search( players ) > 0 ) {

			/*
			 * Calculate the video ratio based on the iframe's w/h dimensions
			 */
			var width             = iframe.width;
			var height            = iframe.height;
			var videoRatio        = ( height / width ) * 100;
			
			/*
			 * Replace the iframe's dimensions and position
			 * the iframe absolute, this is the trick to emulate
			 * the video ratio
			 */
			iframe.style.position = 'absolute';
			iframe.style.top      = '0';
			iframe.style.left     = '0';
			iframe.width          = '100%';
			iframe.height         = '100%';
			
			/*
			 * Wrap the iframe in a new <div> which uses a
			 * dynamically fetched padding-top property based
			 * on the video's w/h dimensions
			 */
			var wrap              = document.createElement( 'div' );
			wrap.className        = 'video-wrap';
			wrap.style.width      = '100%';
			wrap.style.position   = 'relative';
			wrap.style.paddingTop = videoRatio + '%';
			
			/*
			 * Add the iframe inside our newly created <div>
			 */
			var iframeParent      = iframe.parentNode;
			iframeParent.insertBefore( wrap, iframe );
			wrap.appendChild( iframe );
			
			/*
			 * Wrap the div in a new <div> which is used
			 * to set a max width accordin to the video's dimensions
			 */
			var outerWrap         = document.createElement( 'div' );
			wrap.className        = 'outer-video-wrap';
			wrap.style.maxWidth   = width + 'px';
			
			/*
			 * Add the div wrap inside our newly created <div>
			 */
			var wrapParent       = wrap.parentNode;
			wrapParent.insertBefore( outerWrap, wrap );
			wrap.appendChild( wrap );

		}

	}

})( window, document );